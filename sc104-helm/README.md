# Developing Helm Charts (SC104)

[catalog link](https://training.linuxfoundation.org/certification/helm/)

## disclaimer

```shell
❯ helm version
version.BuildInfo{Version:"v3.16.3", GitCommit:"cfd07493f46efc9debd9cc1b02a0961186df7fdf", GitTreeState:"dirty", GoVersion:"go1.23.3"}
```

mock questions are based on the record from my coworker who already passed the exam and chatgpt's response, the former is by a prompt.

recommend to use vim

## mock q1

> Scenario: You are managing a Helm chart that deploys a single container Deployment. Your task is to modify the templates/deployment.yaml file to add the annotation `"cluster-autoscaler.kubernetes.io/safe-to-evict": "false"` to the Deployment. This annotation ensures that the cluster autoscaler will not evict this Deployment under any conditions. Make the necessary changes to the Helm template to add this annotation.

<details>
  <summary>a solution</summary>

  <p>
if the deployment template is generated by the default starter chart, <code/>spec.template.metadata.annotations</code> would be placed when <code>.Values.podAnnotations</code> is given.
  </p>

<pre>
    <code class="language-yaml">
      {{- with .Values.podAnnotations }}
      annotations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
    </code>
</pre>

  <p>
    if then, have to pull out the <code>annotations</code> from with block and add the annotation.
  </p>

  <pre>
    <code class="language-yaml">
      annotations:
        "cluster-autoscaler.kubernetes.io/safe-to-evict": "false"
      {{- with .Values.podAnnotations }}
        {{- toYaml . | nindent 8 }}
      {{- end }}
    </code>
  </pre>

  <p>
    do not miss the annotation should be in `spec.template.metadata`, the pods one not in `metadata`, the deploy's.
  </p>

  <pre>
    <code class="language-shell">
      # validate by helm template
      ❯ helm template . | yq 'select(.kind=="Deployment").spec.template.metadata.annotations'
"cluster-autoscaler.kubernetes.io/safe-to-evict": "false"

      # should not be in deploy's metadata
      ❯ helm template . | yq 'select(.kind=="Deployment").metadata.annotations'
null

      # + validate the value `podAnnotations` is working properly
      ❯ helm template --set podAnnotations.another-annotations=here . | yq 'select(.kind=="Deployment").spec.template.metadata.annotations'
"cluster-autoscaler.kubernetes.io/safe-to-evict": "false"
another-annotations: here
    </code>
  </pre>

</details>
